# ðŸš‚ Backend Deployment on Railway

## ðŸŽ¯ Why Railway?

- âœ… **Easiest** - Auto-detects Python/FastAPI
- âœ… **Free tier** available
- âœ… **Auto-deploys** from GitHub
- âœ… **PostgreSQL included**
- âœ… **Simple setup**

---

## ðŸ“‹ Step-by-Step

### **Step 1: Sign Up**

1. Go to [railway.app](https://railway.app)
2. Click "Start a New Project"
3. Sign up with GitHub
4. Authorize Railway

---

### **Step 2: Create Project**

1. **Click "New Project"**
2. **Select "Deploy from GitHub repo"**
3. **Choose your repository** (Insightlite)
4. **Railway detects** it's a Python project

---

### **Step 3: Configure Service**

Railway will auto-detect, but verify:

**Settings:**
- **Root Directory:** `backend`
- **Build Command:** `pip install -r requirements.txt`
- **Start Command:** `uvicorn app.main:app --host 0.0.0.0 --port $PORT`

**If not auto-detected:**
1. Go to Settings â†’ Deploy
2. Set Root Directory: `backend`
3. Set Start Command: `uvicorn app.main:app --host 0.0.0.0 --port $PORT`

---

### **Step 4: Add PostgreSQL Database**

1. **In Railway project, click "+ New"**
2. **Select "Database"**
3. **Select "PostgreSQL"**
4. **Railway creates database automatically**

---

### **Step 5: Set Environment Variables**

In Railway project â†’ Variables tab, add:

```
DATABASE_URL=<auto-generated>
JWT_SECRET_KEY=<generate-strong-random-key>
OPENAI_API_KEY=<your-openai-key>
CORS_ORIGINS=https://meldra.vercel.app,https://*.vercel.app
ACCESS_TOKEN_EXPIRE_MINUTES=30
ENVIRONMENT=production
LOG_LEVEL=INFO
```

**To get DATABASE_URL:**
- Click on PostgreSQL service
- Go to "Variables" tab
- Copy `DATABASE_URL` value
- Paste into main service variables

**To generate JWT_SECRET_KEY:**
```bash
# In terminal
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

---

### **Step 6: Deploy**

Railway auto-deploys when you:
- Push to GitHub
- Or click "Deploy" button

**Wait for deployment** (2-5 minutes)

---

### **Step 7: Get Backend URL**

1. **Click on your service**
2. **Go to "Settings" tab**
3. **Find "Domains" section**
4. **Copy the URL** (e.g., `https://meldra-production.up.railway.app`)

---

### **Step 8: Update Frontend**

```bash
# Update Vercel environment variable
vercel env add VITE_API_URL production
# Enter: https://your-railway-url.com

# Redeploy frontend
vercel --prod
```

---

## âœ… Verification

### **Test Backend:**
```bash
# Health check
curl https://your-railway-url.com/health

# Should return: {"status": "healthy"}
```

### **Test Frontend:**
- Go to your Vercel URL
- Try logging in
- Check browser console for errors

---

## ðŸ”§ Troubleshooting

### **Deployment Fails:**
- Check Railway logs
- Verify `requirements.txt` is in `backend/` folder
- Check environment variables are set

### **Database Connection Error:**
- Verify `DATABASE_URL` is correct
- Check database is running (Railway dashboard)
- Remove `&channel_binding=require` if present

### **CORS Errors:**
- Update `CORS_ORIGINS` to include your Vercel URL
- Redeploy backend

---

## ðŸ“‹ Railway CLI (Alternative)

```bash
# Install
npm i -g @railway/cli

# Login
railway login

# Link project
railway link

# Set variables
railway variables set DATABASE_URL="postgresql://..."
railway variables set JWT_SECRET_KEY="your-secret"

# Deploy
railway up
```

---

## ðŸ’° Pricing

- **Free tier:** $5 credit/month
- **Hobby:** $5/month (after free tier)
- **Pro:** $20/month

**Free tier is usually enough for testing!**

---

## âœ… That's It!

Once deployed:
- âœ… Backend is live
- âœ… Database connected
- âœ… Frontend can connect
- âœ… Ready for production!

---

**See `COMPLETE_DEPLOYMENT_GUIDE.md` for full deployment process.**
